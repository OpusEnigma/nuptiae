services:
  nuptiae:
    build: .
    container_name: nuptiae
    working_dir: /app

    volumes:
      - .:/app
      - node_modules:/app/node_modules

    ports:
      - "4321:4321"

    # N'installe les deps que si node_modules est vide
    command: >
      sh -c "
      if [ ! -d node_modules/astro ]; then
        echo 'ðŸ“¦ Installing dependenciesâ€¦';
        npm install;
      fi &&
      npm run dev -- --host
      "

volumes:
  node_modules:
