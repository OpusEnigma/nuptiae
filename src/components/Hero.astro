---
import { getImage } from "astro:assets";
import { getRitualPath, getLocationPath, getRegionPath, getSeasonPath } from "../utils/paths";
import HeroCard from "./HeroCard.astro";

import heroImage from "../assets/hero-image.png";

const hero = await getImage({
  src: heroImage,
  widths: [640, 1280, 1920],
  formats: ["webp", "avif"],
});
---

<section class="hero">
  <!-- blurred background -->
  <div class="hero-bg">
    <img
      src={hero.src}
      srcset={hero.srcset}
      sizes="100vw"
      alt=""
      aria-hidden="true"
      loading="eager"
      decoding="async"
    />
  </div>

  <!-- sharp foreground -->
  <div class="hero-fg">
    <img
      src={hero.src}
      srcset={hero.srcset}
      sizes="(max-width: 1200px) 100vw, 1200px"
      alt=""
      aria-hidden="true"
      loading="eager"
      decoding="async"
    />
  </div>

  <!-- cards -->
  <div class="hero-cards">
    <HeroCard
      href={getRitualPath()}
      eyebrow="Découvrir →"
      title="Les cérémonies"
      subcards={[
        { label: "Khata", href: `${getRitualPath()}#khata` },
        { label: "Geet Gawai",  href: `${getRitualPath()}#geet` },
        { label: "Haldi", href: `${getRitualPath()}#haldi` },
      ]}
    />

    <HeroCard
      href={getLocationPath()}
      eyebrow="Explorer →"
      title="Le lieu"
      subcards={[
        { label: "Région",        href: `${getLocationPath()}#location-region` },
      ]}
    />

    <HeroCard
      href={getSeasonPath()}
      eyebrow="Découvrir →"
      title="La saison"
      subcards={[
        { label: "Températures", href: `${getSeasonPath()}#season-temperature` },
        { label: "Précipitations", href: `${getSeasonPath()}#season-precipitation` },
        { label: "Vent", href: `${getSeasonPath()}#season-wind` },
        { label: "Humidité", href: `${getSeasonPath()}#season-humidity` },
      ]}
    />
  </div>
</section>

<style>
  /* Hero layout */
  .hero {
    position: relative;
    height: 100vh;
    min-height: clamp(640px, 100svh, 100vh);
    overflow: hidden;
    background: #0b0b0d;
  }

  /* Background layers */

  .hero-bg {
    position: absolute;
    inset: 0;
  }

  .hero-bg img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transform: scale(1.28);
    filter: blur(34px) brightness(.38) saturate(1.12);
  }

  .hero::before,
  .hero::after {
    content: "";
    position: absolute;
    inset: 0;
    pointer-events: none;
  }

  .hero::before {
    background:
      radial-gradient(ellipse at center,
        rgba(0,0,0,0) 55%,
        rgba(0,0,0,.35) 78%,
        rgba(0,0,0,.65) 100%);
  }

  .hero::after {
    background:
      radial-gradient(circle at 50% 55%,
        rgba(255,200,120,.18) 0%,
        rgba(255,200,120,.10) 18%,
        rgba(255,200,120,.04) 32%,
        rgba(0,0,0,0) 55%);
  }

  /* Foreground image */

  .hero-fg {
    position: relative;
    height: 100%;
    display: grid;
    place-items: center;
  }

  .hero-fg img {
    width: min(96vw, 1600px);
    max-height: 94vh;
    object-fit: contain;

    mask-image: linear-gradient(to right,
      transparent 0%,
      black 1.5%,
      black 98.5%,
      transparent 100%);
    -webkit-mask-image: linear-gradient(to right,
      transparent 0%,
      black 1.5%,
      black 98.5%,
      transparent 100%);

    filter:
      drop-shadow(0 22px 60px rgba(0,0,0,.65))
      contrast(1.06)
      saturate(1.08);
  }

  /* Cards */

  .hero-cards {
    position: absolute;
    top: 50%;
    left: 4%;
    transform: translateY(-50%);
    display: flex;
    flex-direction: column;
    gap: var(--space-4);
    pointer-events: none;
  }

  /* Mobile & tablet */
  @media (max-width: 900px) {
    .hero {
      height: 100svh;
      min-height: 100svh;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      overflow: hidden;
      background:
        linear-gradient(to bottom,
          #0b0b0d 0%,
          #1a1410 40%,
          #22160f 100%);
    }

    .hero-bg,
    .hero::before,
    .hero::after {
      display: none;
    }

    /* Hero image — fixed at top, does not scroll */
    .hero-fg {
      flex-shrink: 0;
      height: auto;
      width: 100%;
      display: grid;
      place-items: center;
      padding-top: var(--space-3);
    }

    .hero-fg img {
      width: 92vw;
      max-height: none;
      border-radius: var(--space-4);
    }

    /* Cards — same width as image, scrollable */
    .hero-cards {
      position: relative;
      inset: auto;
      transform: none;
      width: 92vw;
      flex: 1;
      overflow-x: hidden;
      overflow-y: auto;
      scrollbar-width: none;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      gap: var(--space-4);
      padding: var(--space-4) 0 var(--space-6);
      pointer-events: auto;
    }

    .hero-cards::-webkit-scrollbar {
      display: none;
    }
  }
</style>
