---
import { Image } from "astro:assets";

const { image, side = "left" } = Astro.props;

if (!image) {
  throw new Error("RitualBlock requires an image.");
}

const sideClass = side === "right" ? "block--right" : "block--left";
---

<div class={`ritual-block ${sideClass}`}>
  <div class="block-media">
    <Image
      src={image}
      alt=""
      loading="lazy"
      sizes="(max-width: 900px) 100vw, 50vw"
    />
  </div>

  <div class="block-content">
    <slot />
  </div>
</div>

<style>
  /* Layout */
  .ritual-block {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: clamp(var(--space-5), 8vw, var(--space-7));
    align-items: start;
    margin-bottom: clamp(var(--space-6), 8vw, var(--space-7));
  }

  /* Alternate layout */
  .block--right {
    direction: rtl;
  }

  .block--right > * {
    direction: ltr;
  }

  /* Media */
  .block-media :global(img) {
    display: block;
    width: 100%;
    height: auto;
  }

  /* Content */
  .block-content {
    max-width: 52ch;
  }

  .block-content p:last-child {
    margin-bottom: 0;
  }

  /* Mobile layout */
  @media (max-width: 900px) {
    .ritual-block {
      grid-template-columns: 1fr;
      gap: var(--space-5);
      margin-bottom: var(--space-6);
    }

    .block--right {
      direction: ltr;
    }

    .block-content {
      max-width: 100%;
    }
  }

  /* Dark mode */
  @media (prefers-color-scheme: dark) {
    .ritual-block {
      color: var(--color-text);
    }
  }
</style>
